<!DOCTYPE html>
<html> 
  <head>
    <title> Hello Campus!</title>
    <link rel ="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  
    <style>
      #map {height: 400px; width: 680px; margin: 10px; }
      #map2 {height: 400px; width: 680px; margin: 10px; }

      html, body { height: 100%; margin: 0; padding: 0; }
    </style>

    <script src="WAPovertyData.geojson">
    </script>
    <script src="WAHighSchoolData.geojson">
    </script>
  
    <script>
      var schoolLayer;
      var schoolVisible = true;
      var povertyLayer;
      var povertyVisible = true;
      var OpenStreetMap_HOT = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',
                                          { maxZoom: 19, 
                                              attribution: '&copy; <a href="http:/www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.osm.org">HOT OSM</a>'
                                          });
        
      function schoolSymbology(feature) {
        var numDiplomas = feature.properties.Percent_Without_Diploma;
        var areaColor = "#00008B";

        if (numDiplomas > 14.7) {
          areaColor = "#eb5e0c"; 
        }
        if (numDiplomas > 25) {
          areaColor = "#eb0c0f"; 
        }

        return {
          color: areaColor,
          opacity: 1
        };
      }

      function povertySymbology(feature) {
        var numDiplomas = feature.properties.Percent_Living_in_Poverty;
        var areaColor = "#00008B";

        if (numDiplomas > 30) {
          areaColor = "#eb5e0c"; 
        }
        if (numDiplomas > 50) {
          areaColor = "#eb0c0f"; 
        }else{
          opacity: 1;
        }

        return {
          color: areaColor,
          opacity: 1
        };
      }
      
      function initialize() {
          var map = L.map('map', { 
                      center: [ 47.691, -122.278 ],
                      zoom: 15,
                      layers: [OpenStreetMap_HOT]
              });

          var responseSchool = $.ajax({
            url: "WAHighSchoolData.geojson",
            dataType: "json",
            success: console.log("school data loaded!"),
            error: function(xhr){
              alert(xhr.statusText);
            }
          });
        
        
        $.when(responseSchool).done(function() {
              schoolLayer = L.geoJson(responseSchool.responseJSON,
                            { style: schoolSymbology,
                            onEachFeature: function(feature, layer) {
                layer.bindPopup("<b> Number Without Diploma: " + feature.properties.Num_Without_Diploma + "<\b><br>" + "Census Tract: " + 
                                feature.properties.Census_Tract + "<br>" + "Percent Without Diploma: " + feature.properties.Percent_Without_Diploma);
              }
              }).addTo(map);
              $("#toggleSchool").show();
          
              $("#toggleSchool").click(function() {
                    if(schoolVisible) {
                      schoolVisible = false;
                      schoolLayer.removeFrom(map);
                    }else{
                      schoolVisible = true;
                      schoolLayer.addTo(map);
                    }
              }) 
        })

      //second map
        var map2 = L.map('map2', {
            center: [ 47.691, -122.278 ],
            zoom: 15,
            layers: [OpenStreetMap_HOT]
        });

        var responsePoverty = $.ajax({
          url: "WAPovertyData.geojson",
          dataType: "json",
          success: console.log("poverty data loaded!"),
          error: function(xhr){
            alert(xhr.statusText);
          }
        });

        $.when(responsePoverty).done(function() {
              povertyLayer = L.geoJson(responsePoverty.responseJSON,
                            { style: povertySymbology,
                            onEachFeature: function(feature, layer) {
                layer.bindPopup("Census Tract: " + feature.properties.Census_Tract + "<br>" + "Total Population: " + feature.properties.Total_Population + "<br>" + "Number living in Poverty " + 
                                feature.properties.Num_Living_in_Poverty + "<br>" + "Percent Living in Poverty: " + feature.properties.Percent_Living_in_Poverty);
              }
              }).addTo(map2);
              $("#togglePoverty").show();
          
              $("#togglePoverty").click(function() {
                    if(povertyVisible) {
                      povertyVisible = false;
                      povertyLayer.removeFrom(map2);
                    }else{
                      povertyVisible = true;
                      povertyLayer.addTo(map2);
                    }
              }) 
        })
  }  
          
    </script>
  </head>
  <body onload="initialize()"> 
    <h1>Visualizing the relationship between education and poverty</h1>
    Click on a county to view specific information!
    <div id = "map"></div>
    <div id = "button"><button id="toggleSchool" hidden> Highschool graduation layer</button></div>
    
    <div id = "map2"></div>
    <div id = "button"><button id="togglePoverty" hidden> Poverty layer</button></div>
    The national average high school graduation rate is 85%. 
    In the map above I've highlighted the counties in Washington which have a percentage below that rate. 
    Hover above them to learn more statistics.
  </body>
</html>
